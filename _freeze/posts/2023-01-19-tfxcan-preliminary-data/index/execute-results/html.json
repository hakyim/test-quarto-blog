{
  "hash": "9b2e840ea4549b45311bdfb965f1cf5b",
  "result": {
    "markdown": "---\ntitle: TFXcan preliminary data\nauthor: Haky Im\ndate: '2023-01-19'\nslug: tfxcan-preliminary-data\ncategories:\n  - analysis\ntags: []\neditor_options: \n  chunk_output_type: console\n---\n\n\nBased on Temi's (FOXA1) TF prediction from DNAseq\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressMessages(library(tidyverse))\nsuppressMessages(library(glue))\nPRE = \"/Users/haekyungim/Library/CloudStorage/Box-Box/LargeFiles/imlab-data/data-Github/web-data\"\n##PRE=\"/Users/margaretperry/Library/CloudStorage/Box-Box/imlab-data/data-Github/web-data \"\n##PRE=\"/Users/temi/Library/CloudStorage/Box-Box/imlab-data/data-Github/web-data\"\n## COPY THE DATE AND SLUG fields FROM THE HEADER\nSLUG=\"tfxcan-preliminary-data\" ## copy the slug from the header\nbDATE='2023-01-19' ## copy the date from the blog's header here\nDATA = glue(\"{PRE}/{bDATE}-{SLUG}\")\nif(!file.exists(DATA)) system(glue::glue(\"mkdir {DATA}\"))\nWORK=DATA\n\n## move data to DATA\n#tempodata=(\"~/Downloads/tempo/gwas_catalog_v1.0.2-associations_e105_r2022-04-07.tsv\")\n#system(glue::glue(\"cp {tempodata} {DATA}/\"))\n## system(glue(\"open {DATA}\")) ## this will open the folder \n```\n:::\n\n\nRead Temi's data\n\n::: {.cell}\n\n```{.r .cell-code}\n##source qqunif gist\ndevtools::source_gist(\"38431b74c6c0bf90c12f\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nℹ Sourcing gist \"38431b74c6c0bf90c12f\"\nℹ SHA-1 hash of file is \"c5aba9ddce06b95125b727d96bffe7bd1557fcc3\"\n```\n:::\n\n```{.r .cell-code}\ntempo <- readRDS(glue(\"{DATA}/freedman_FOXA1_predicted_vs_observed_matrix_2023-01-19.rds\"))\nhead(tempo$observed)[,1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    region LuCaP_173 LuCaP_167 LuCaP_93 LuCaP_81\n1 chr1_100004103_100004112         0         0        0        0\n2 chr1_100047865_100047874         0         0        0        0\n3 chr1_100057135_100057144         0         0        0        0\n4 chr1_100118800_100118809         0         0        0        0\n5 chr1_100130867_100130876         0         1        0        0\n6 chr1_100162937_100162946         0         0        0        0\n```\n:::\n\n```{.r .cell-code}\nhead(tempo$predicted)[,1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    region LuCaP_173 LuCaP_167  LuCaP_93  LuCaP_81\n1 chr1_100004103_100004112 0.2428343 0.2438005 0.2439815 0.2422898\n2 chr1_100047865_100047874 0.1331662 0.1348004 0.1343903 0.1313637\n3 chr1_100057135_100057144 0.2555964 0.2728396 0.2716254 0.2644257\n4 chr1_100118800_100118809 0.1309184 0.1311011 0.1311917 0.1304301\n5 chr1_100130867_100130876 0.6093923 0.6089561 0.6101078 0.6093229\n6 chr1_100162937_100162946 0.1385310 0.1386486 0.1376289 0.1395273\n```\n:::\n\n```{.r .cell-code}\nidentical(tempo$observed$region, tempo$predicted$region)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n\n```{.r .cell-code}\nobs <- tempo$observed %>% select(-region) %>% as.matrix\nrownames(obs) <- tempo$observed$region\n\npred <- tempo$predicted %>% select(-region) %>% as.matrix\nrownames(pred) <- tempo$predicted$region\n\nidentical(rownames(obs), rownames(pred))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n\n```{.r .cell-code}\n## remove sites with no binding\nnbou <- apply(obs,1,sum)\nind <- nbou>3 & nbou < 14\nobs <- obs[ind,]\npred <- pred[ind,]\nidentical(rownames(obs), rownames(pred))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n\n```{.r .cell-code}\npvec = rep(NA,nrow(obs))\ntvec = rep(NA,nrow(obs))\nfor(cc in 1:nrow(obs) ) \n{\n  res = t.test(pred[cc,obs[cc,]==1], pred[cc,obs[cc,]==0])\n  pvec[cc] = res$p.value\n  tvec[cc] = res$statistic\n  }\n\nhist(pvec)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nqqunif(pvec)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n:::\n\n\n## permute sites for observed\n\n::: {.cell}\n\n```{.r .cell-code}\nfor(pp in 1:4)\n{\nobs_perm <- obs[sample(1:nrow(obs),nrow(obs),replace=FALSE),]\npvec_perm = rep(NA,nrow(obs))\nfor(cc in 1:nrow(obs) ) \n{\n  res = t.test(pred[cc,obs_perm[cc,]==1], pred[cc,obs_perm[cc,]==0])\n  pvec_perm[cc] = res$p.value\n  }\n\ntitulo = glue(\"perm-{pp}:\")\nprint(titulo)\n##hist(pvec_perm,main=titulo)\nqqunif(pvec_perm,main=titulo)\nqqplot(-log10(pvec_perm), -log10(pvec), \n       main=paste(titulo ))\nabline(0,1)\npar(mfrow=c(1,1))\n\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nperm-1:\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nperm-2:\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-4.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nperm-3:\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-5.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-6.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nperm-4:\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-7.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-8.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}